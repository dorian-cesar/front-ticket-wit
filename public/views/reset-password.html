<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nueva Contraseña - Mesa de Ayuda Pullman Bus</title>
    <link rel="icon" href="/img/logo-pullman-min.png" type="image/png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/styles.css" />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    ></script>
    <script defer src="/js/reset-password.js"></script>
  </head>

  <body>
    <div class="container">
      <div class="row justify-content-center align-items-center">
        <div class="card-login col-md-7 col-lg-5 col-xl-4">
          <div class="login-container">
            <div class="company-logo">
              <img
                style="width: 200px"
                src="/img/logo-pullman-nuevo.svg"
                alt="Logo Pullman"
              />
            </div>
            <div class="login-header">
              <h2>Nueva Contraseña</h2>
              <p>Crea una contraseña segura para tu cuenta</p>
            </div>

            <!-- Alert para mensajes -->
            <div id="alertContainer"></div>

            <!-- Token inválido o expirado -->
            <div id="invalidTokenContainer" class="d-none">
              <div class="alert alert-danger text-center">
                <i class="bi bi-exclamation-triangle fs-1 mb-3"></i>
                <h5>Enlace inválido o expirado</h5>
                <p class="mb-3">
                  Este enlace de recuperación no es válido o ha expirado.
                </p>
                <button
                  class="btn btn-primary btn-login w-100"
                  onclick="window.location.href='forgot-password.html'"
                >
                  <i class="bi bi-arrow-left me-1"></i>
                  Solicitar nuevo enlace
                </button>
              </div>
            </div>

            <form id="resetPasswordForm" novalidate>
              <div class="mb-3">
                <label for="password" class="form-label">
                  <i class="bi bi-lock me-1"></i>
                  Nueva Contraseña
                </label>
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="bi bi-key"></i>
                  </span>
                  <input
                    type="password"
                    class="form-control"
                    id="password"
                    placeholder="Ingresa tu nueva contraseña"
                    required
                    autocomplete="new-password"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="togglePassword"
                    tabindex="-1"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="invalid-feedback">
                    La contraseña debe cumplir con los requisitos mínimos.
                  </div>
                </div>
                <!-- Indicador de fortaleza -->
                <div class="password-strength mt-2">
                  <div class="progress" style="height: 4px">
                    <div
                      class="progress-bar"
                      id="strengthBar"
                      role="progressbar"
                      style="width: 0%"
                    ></div>
                  </div>
                  <small id="strengthText" class="form-text">
                    La contraseña debe tener al menos 8 caracteres
                  </small>
                </div>
              </div>

              <div class="mb-3">
                <label for="confirmPassword" class="form-label">
                  <i class="bi bi-lock-fill me-1"></i>
                  Confirmar Contraseña
                </label>
                <div class="input-group">
                  <span class="input-group-text">
                    <i class="bi bi-key-fill"></i>
                  </span>
                  <input
                    type="password"
                    class="form-control"
                    id="confirmPassword"
                    placeholder="Confirma tu nueva contraseña"
                    required
                    autocomplete="new-password"
                  />
                  <button
                    class="btn btn-outline-secondary"
                    type="button"
                    id="toggleConfirmPassword"
                    tabindex="-1"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="invalid-feedback">
                    Las contraseñas no coinciden.
                  </div>
                </div>
              </div>

              <!-- Requisitos de contraseña -->
              <div class="password-requirements mb-4">
                <small class="text-muted">
                  <strong>Requisitos de contraseña:</strong>
                </small>
                <ul class="requirements-list mt-1">
                  <li id="req-length" class="requirement">
                    <i class="bi bi-x-circle text-danger"></i>
                    Al menos 8 caracteres
                  </li>
                  <li id="req-basic" class="requirement">
                    <i class="bi bi-x-circle text-danger"></i>
                    Contener letras y números
                  </li>
                </ul>
              </div>

              <button
                type="submit"
                class="btn btn-primary btn-login w-100 mb-3"
                id="submitBtn"
                disabled
              >
                <span
                  id="resetSpinner"
                  class="spinner-border spinner-border-sm d-none me-2"
                  role="status"
                ></span>
                <span id="resetText">
                  <i class="bi bi-check-circle me-1"></i>
                  Establecer Nueva Contraseña
                </span>
              </button>

              <div class="text-center">
                <a
                  href="../index.html"
                  class="forgot-password"
                  id="backToLoginLink"
                >
                  <i class="bi bi-arrow-left me-1"></i>
                  Volver al Login
                </a>
              </div>
            </form>

            <div class="company-info">
              <p class="version-info mt-2">Mesa de Ayuda Pullman Bus</p>
              <p class="version-info mt-2">v1.0.1 | 2025 WIT©</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
